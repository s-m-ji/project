<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.MemberMapper">

<!-- member 목록 조회 -->
<select id="memberList" resultType="com.project.vo.MemberVo"> 
      
   <![CDATA[select * from (
  select rownum rn, t.* from (
    SELECT m.mno, m.email, m.name, m.nickname, m.pnum,TO_CHAR(m.reg_date, 'YY/MM/DD') reg_dateStr , m.gno, DECODE(m.delYN, 'Y', '신청', '미신청') delYNStr, g.grade, g.benefit
        FROM rec_member m
        JOIN rec_grade g ON m.gno = g.gno
        where mno > 0]]>
        <include refid="criteria"></include>
        order by mno desc 
        ) t
        ) where rn between #{startNo} and #{endNo}
</select>

<!-- 회원 총 건수  -->
<select id="getTotalCnt" resultType="int">
 SELECT count(*)
        FROM rec_member m
        JOIN rec_grade g ON m.gno = g.gno
        <include refid="criteria"></include>
</select>

<!-- 회원 삭제 -->
<delete id="delMem" parameterType="java.lang.String" statementType="PREPARED">
	delete from rec_member where mno = #{mno} and delyn = #{delyn}
</delete>

<!--  공지 조회  -->
<select id="noticeList" resultType="com.project.vo.NoticeVo">
	<![CDATA[SELECT * FROM (
	SELECT ROWNUM RN, T.* FROM (
	SELECT REC_NOTICE.* FROM REC_NOTICE WHERE NNO >0 ]]>
	<include refid="nCriteria"></include>
	ORDER BY NNO DESC
	) T 
	) WHERE RN BETWEEN #{startNo} and #{endNo}
</select>

<!--  공지 총 건수 -->
<select id="getTotalNcnt" resultType="int">
select count(*) from rec_notice  where 1=1 <include refid="nCriteria"></include>
</select>


<!--  공지 등록  -->
<insert id="noticeWrite">
<selectKey keyProperty="nno" order="BEFORE" resultType="int">
	select seq_notice.nextval from dual
</selectKey>
	insert into REC_NOTICE (nno, nwriter, gubun, ntitle, ncontent) values (#{nno}, #{nwriter}, #{gubun}, #{ntitle}, #{ncontent})
</insert>

<!--  공지 한 건  -->
<select id="noticeOne" resultType="com.project.vo.NoticeVo">
	select * from rec_notice where nno = #{nno}
</select>

<!--  공지 수정  -->
<update id="noticeUpdate">
	update rec_notice 
	set ntitle = #{ntitle}, ncontent =#{ncontent}, nregdate = sysdate  where nno = #{nno}
</update>

<!--  공지 삭제  -->
<delete id="noticeDel">
	delete from rec_notice where nno = #{nno}
</delete>


<!-- 공통 검색조건1) 회원  -->
<sql id="criteria">
	<choose>
		<when test="sField  == 'name'">
			and name like '%'||#{sWord}||'%'
		</when>
		<when test="sField  == 'grade'">
			and grade like '%'||#{sWord}||'%' 
		</when>
		<when test="sField  == 'delYN'">
			and delYN like '%'||#{sWord}||'%' 
		</when>
	</choose>
</sql>  

<!-- 공통 검색조건2) 공지  -->
<sql id="nCriteria">
	<choose>
		<when test="sField  == '일반'">
			and gubun like '%일반%'
		</when>
		<when test="sField  == '이벤트'">
			and gubun like '%이벤트%'
		</when>
		<when test="sField  == '자주 묻는 질문'">
			and gubun like '%자주 묻는 질문%'
		</when>
	</choose>
</sql>  



</mapper>