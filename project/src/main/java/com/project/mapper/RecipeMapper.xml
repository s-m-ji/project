<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.project.mapper.RecipeMapper">
<!-- 	<select id="getRecList" resultType="com.project.vo.BoardVO">
			SELECT * FROM rec_board_test 	
	</select> -->
<select id="getRecList" resultType="com.project.vo.BoardVO">
		SELECT *
				FROM (
				  SELECT t.*, ROWNUM rn
				  FROM (
				          SELECT rt.title, rt.regdate, rt.nickname, rt.intro, rt.b_no, rt.boomup,
				          			CASE WHEN rt.regdate >= TRUNC(SYSDATE) - 3 THEN 'new' ELSE '' END AS newpost,
				          			rc.C_NO1, rc.C_NO2, rc.catename1, rc.catename2 
				          	FROM rec_board rt, rec_category rc
				          	 WHERE rc.C_NO1 = rt.C_NO1
				          	  AND rc.C_NO2 = rt.C_NO2
				          	  AND intro LIKE '%' || #{sWord} || '%'
				            <include refid="criteria"></include>
					        <choose>
			                    <when test="orderBy">
			                        <include refid="orderByRegidate"></include>
			                    </when>
			                    <otherwise>
			                        <include refid="orderByBoomUp"></include>
			                    </otherwise>
			                </choose>
				  ) t
				)
				WHERE rn BETWEEN #{startNo} AND #{endNo}
	</select>
	
	
	<select id="getListTotalCnt" resultType="int">
		SELECT COUNT(*)
			FROM (
			  SELECT *
		       FROM rec_board rt, rec_category rc
		          	 WHERE rc.C_NO1 = rt.C_NO1
		          	  AND rc.C_NO2 = rt.C_NO2
		          	  AND intro LIKE '%' || #{sWord} || '%'
		            <include refid="criteria"></include>
			 )
	</select>
	
	<select id="getOne" resultType="com.project.vo.BoardVO">
		SELECT * FROM rec_board WHERE B_NO = #{b_NO}
	</select>

	<sql id="criteria">
    <choose>
        <!-- c1, c2에 따라 조건을 추가하는 부분 -->
        <when test="c1 != null and c1 != ''">
		    AND rc.C_NO1 = #{c1}
		    <if test="c2 != null and c2 != ''">
		        AND rc.C_NO2 = #{c2}
		    </if>
		</when>
    </choose>
	</sql>
	
	<sql id="orderByRegidate"> ORDER BY rt.regdate DESC </sql>
	<sql id="orderByBoomUp"> ORDER BY rt.boomup DESC </sql>
	
	

	
</mapper>