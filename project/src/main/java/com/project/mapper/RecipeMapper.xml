<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.project.mapper.RecipeMapper">
<!-- 	<select id="getRecList" resultType="com.project.vo.BoardVO">
			SELECT * FROM rec_board_test 	
	</select> -->
<select id="getRecList" resultType="com.project.vo.BoardVO">
		SELECT *
				FROM (
				  SELECT t.*, ROWNUM rn
				  FROM (
				    SELECT rc.catename, rc.C_NO,
			                rt.title, rt.regdate, rt.nickname,
			                 rm.B_NO,
			                  ri.I_NO, ri.I_NAME
				        FROM rec_board rt, rec_category rc, rec_material rm, rec_ingredients ri
				            WHERE rc.C_NO = rt.C_NO
				            AND rt.B_NO = rm.B_NO
				            AND rm.I_NO = ri.I_NO
				            <include refid="criteria"></include>
				        ORDER BY B_NO DESC
				  ) t
				)
				WHERE rn BETWEEN #{startNo} AND #{endNo}
	
	</select>
	
	<select id="getListTotalCnt" resultType="int">
		SELECT COUNT(*)
			FROM (
			  SELECT *
			  FROM rec_board rt, rec_category rc, rec_material rm, rec_ingredients ri
		            WHERE rc.C_NO = rt.C_NO
		            AND rt.B_NO = rm.B_NO
		            AND rm.I_NO = ri.I_NO <include refid="criteria"></include>
			 )
	</select>
	
	<select id="getOne" resultType="com.project.vo.BoardVO">
		SELECT * FROM rec_board WHERE B_NO = #{b_NO}
	</select>

	<sql id="criteria">
		<choose>
			<when test="c2depth = 'c2depth'">
				AND ri.I_NAME LIKE '%'||#{sWord}||'%'
			</when>
			
		</choose>
	</sql>
	
</mapper>